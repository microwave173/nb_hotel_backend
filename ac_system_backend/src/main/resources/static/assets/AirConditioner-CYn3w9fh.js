import{r,D as oe,I as te,K as se,c as k,d as t,a as l,w as c,t as u,u as f,n as N,F as x,e as F,J as d,b as P,o as w,Y as J,Z as ae,_ as le,i as h,Q as ne,E as re,f as H,$ as ce,a0 as ie,P as de,y as ue}from"./index-BE7gfLc4.js";import{_ as pe}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ve={class:"air-conditioner-container"},me={class:"decorative-icons"},fe={class:"temperature-hint"},_e={class:"hint-value"},ge={class:"content-wrapper"},we={class:"page-header"},he={class:"decorative-title"},ye={class:"title-content"},Te={class:"ac-components-wrapper"},be={class:"ac-display"},Ce={class:"temp-display"},ke={class:"mode-display"},Oe={class:"fan-speed"},Se={class:"remote-control remote-card"},Me={class:"remote-display"},Ie={class:"temp-display"},$e={class:"mode-icon"},Ne={class:"fan-speed-display"},xe={class:"remote-buttons"},Pe={class:"temp-controls"},Ve={class:"mode-controls"},Ee={class:"fan-controls"},je={class:"fee-rules"},Be=500,Fe={__name:"AirConditioner",setup(Je){const y=de(),R=ue(),p=r(!1),i=r(24),b=r(24),v=r("cool"),_=r(1),O=r(!1),D=r(22),S=r(!1);r(24);const V=r(24),M=r("cool"),E=r(1);r(!1);let T=null;const C=r(!1),I=r({lowSpeed:1,mediumSpeed:2,highSpeed:3}),$=oe(()=>{switch(_.value){case 1:return"低速";case 2:return"中速";case 3:return"高速";default:return"关闭"}}),q=async()=>{try{const o=await K("Jerry","123123");S.value=!p.value,d.success(S.value?"空调已开启":"空调已关闭")}catch{d.error("操作失败，请重试")}},j=async o=>{const e=b.value+o;if(!(v.value==="cool"?e>=16&&e<=24:e>=22&&e<=28)){d.warning(`${v.value==="cool"?"制冷":"制热"}模式下，温度范围为${v.value==="cool"?"16-24":"22-28"}度`);return}try{V.value=e,d.success(`温度已调节至 ${e}°C`)}catch{d.error("操作失败，请重试")}},A=async()=>{try{const o=v.value==="cool"?"heat":"cool",e=o==="cool"?i.value>=16&&i.value<=24:i.value>=22&&i.value<=28;let s=i.value;e||(o==="cool"?s=i.value>24?24:16:s=i.value<22?22:28),M.value=o,i.value!==s&&(i.value=s,d.warning(`温度已自动调整至${s}°C以符合${o==="cool"?"制冷":"制热"}模式要求`)),d.success(`已切换至${o==="cool"?"制冷":"制热"}模式`)}catch{d.error("操作失败，请重试")}},L=async()=>{const o=_.value>=3?1:_.value+1;try{E.value=o,d.success(`风速已调节至${$.value}`)}catch{d.error("操作失败，请重试")}},U=()=>{O.value=!0},z=()=>{const o=y.params.roomNumber||"1001";R.push({name:"RoomControl",params:{roomNumber:o}}).catch(e=>{console.error("Navigation error:",e),d.error("返回房间控制页面失败")})},G=()=>{console.log("toggle"),C.value=!C.value},K=async(o,e)=>{try{const s=await fetch("/api/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:o,password:e})});if(!s.ok)throw new Error(`HTTP error! status: ${s.status}`);return await s.text()}catch(s){throw console.error("Login failed:",s.message),s}},Q=async o=>{const e=y.params.roomNumber||"1001",s=v.value==="cool";console.log(o);const n=o?"/api/turn_on_ac":"/api/turn_off_ac";try{const a=await fetch(n,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({roomId:e.slice(-1),acTemperature:22,acMode:0,acOn:o,cool:s})});if(!a.ok)throw new Error(`HTTP error! status: ${a.status}`);return await a.text()}catch(a){throw console.error("Toggle failed:",a.message),a}},Y=()=>{const o=y.params.roomNumber||"1001",e=b.value,s=_.value-1,n=p.value,a=v.value==="cool";return{roomId:o.slice(-1),acTemperature:e,acMode:s,acOn:n,cool:a}},Z=()=>{const o=y.params.roomNumber||"1001",e=V.value,s=E.value-1,n=S.value,a=M.value==="cool";return{roomId:o.slice(-1),acTemperature:e,acMode:s,acOn:n,cool:a}},B=async(o,e)=>{try{const s=await fetch(o,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(e)});if(!s.ok)throw new Error(`HTTP error! status: ${s.status}`);return await s.text()}catch(s){throw console.error("Toggle failed:",s.message),s}},W=async()=>{const o=Y(),e=Z();try{C.value||(o.acOn!==e.acOn&&(o.acOn=e.acOn,await Q(o.acOn)),e.acOn&&(o.cool!==e.cool||o.acTemperature!==e.acTemperature)&&(o.cool=e.cool,o.acTemperature=e.acTemperature,await B("/api/change_ac_temp",o),v.value=M.value),e.acOn&&o.acMode!==e.acMode&&(o.acMode=e.acMode,await B("/api/change_ac_mode",o)))}catch(a){console.log("erq error:",a)}const s=y.params.roomNumber||"1001",n=parseInt(s,10)-1001;try{const a=await fetch("/api/get_room_status",{method:"GET",credentials:"include"});if(!a.ok)throw new Error(`HTTP error! status: ${a.status}`);const g=(await a.json())[n];console.log(g),p.value=g.status!==2,i.value=g.curTemperature,b.value=g.tarTemperature,_.value=g.acMode+1,D.value=g.initTemperature}catch(a){d.error("Failed to fetch status: "+a.message)}},X=()=>{T||(T=setInterval(W,Be))},ee=()=>{T&&(clearInterval(T),T=null)};return te(()=>X()),se(()=>ee()),(o,e)=>{const s=P("el-icon"),n=P("el-button"),a=P("el-dialog");return w(),k(x,null,[t("div",ve,[e[12]||(e[12]=t("div",{class:"background-grid"},null,-1)),t("div",me,[l(s,{class:"dec-icon temp-icon"},{default:c(()=>[l(f(J))]),_:1}),l(s,{class:"dec-icon wind-icon"},{default:c(()=>[l(f(ae))]),_:1}),l(s,{class:"dec-icon cool-icon"},{default:c(()=>[l(f(le))]),_:1})]),t("div",fe,[e[3]||(e[3]=t("div",{class:"hint-text"},"当前室温",-1)),t("div",_e,u(i.value)+"°C",1),e[4]||(e[4]=t("div",{class:"hint-desc"},"舒适温度区间: 18°C - 26°C",-1))]),t("div",ge,[l(n,{onClick:G},{default:c(()=>[h(u(C.value?"测试模式":"使用模式"),1)]),_:1}),t("div",we,[l(n,{type:"primary",icon:f(ne),circle:"",onClick:z,class:"back-button"},null,8,["icon"]),e[5]||(e[5]=t("span",{class:"title"},"返回客房",-1))]),t("div",he,[e[7]||(e[7]=t("div",{class:"title-line left"},null,-1)),t("div",ye,[l(s,{class:"title-icon"},{default:c(()=>[l(f(re))]),_:1}),e[6]||(e[6]=t("span",null,"智能空调控制系统",-1))]),e[8]||(e[8]=t("div",{class:"title-line right"},null,-1))]),t("div",Te,[t("div",{class:N(["ac-unit panel-card",{"ac-on":p.value}])},[t("div",be,[t("div",Ce,u(i.value)+"°C",1),t("div",ke,u(v.value==="cool"?"制冷":"制热"),1),t("div",Oe," 风速: "+u($.value),1)]),t("div",{class:N(["ac-vents",{blowing:p.value}])},[(w(),k(x,null,F(4,m=>t("div",{key:m,class:"vent"})),64))],2)],2),t("div",Se,[t("div",Me,[t("div",Ie,u(b.value)+"°C",1),t("div",$e,[l(s,null,{default:c(()=>[v.value==="cool"?(w(),H(f(J),{key:0})):(w(),H(f(ce),{key:1}))]),_:1})]),t("div",Ne,[(w(!0),k(x,null,F(_.value,m=>(w(),k("div",{key:m,class:"fan-bar"}))),128))])]),t("div",xe,[l(n,{type:"primary",class:N(["power-btn",{"is-on":p.value}]),onClick:q},{default:c(()=>[l(s,null,{default:c(()=>[l(f(ie))]),_:1})]),_:1},8,["class"]),t("div",Pe,[l(n,{onClick:e[0]||(e[0]=m=>j(1)),disabled:!p.value},{default:c(()=>e[9]||(e[9]=[h("+")])),_:1},8,["disabled"]),l(n,{onClick:e[1]||(e[1]=m=>j(-1)),disabled:!p.value},{default:c(()=>e[10]||(e[10]=[h("-")])),_:1},8,["disabled"])]),t("div",Ve,[l(n,{onClick:A,disabled:!p.value},{default:c(()=>[h(u(v.value==="cool"?"制冷":"制热"),1)]),_:1},8,["disabled"])]),t("div",Ee,[l(n,{onClick:L,disabled:!p.value},{default:c(()=>[h(" 风速: "+u($.value),1)]),_:1},8,["disabled"])])])])]),l(n,{class:"fee-info-btn",onClick:U},{default:c(()=>e[11]||(e[11]=[h(" 查看费用规则 ")])),_:1})])]),l(a,{modelValue:O.value,"onUpdate:modelValue":e[2]||(e[2]=m=>O.value=m),title:"空调使用费用规则",width:"400px"},{default:c(()=>[t("div",je,[e[13]||(e[13]=t("h4",null,"当前费率：",-1)),t("ul",null,[t("li",null,"低速风："+u(I.value.lowSpeed)+"元/小时",1),t("li",null,"中速风："+u(I.value.mediumSpeed)+"元/小时",1),t("li",null,"高速风："+u(I.value.highSpeed)+"元/小时",1)]),e[14]||(e[14]=t("p",{class:"fee-note"},"注：费用将根据实际使用时长计算",-1))])]),_:1},8,["modelValue"])],64)}}},De=pe(Fe,[["__scopeId","data-v-8c64506f"]]);export{De as default};
